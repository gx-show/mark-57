<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>myBookList</title>
    <link rel="stylesheet" href="./lib/bootstrap.css">
    <script src="./lib/jquery.js"></script>
</head>

<body style="padding:15px">
    <!-- 图书列表panel面板 -->
    <div class="panel panel-primary">
        <div class="panel-heading">图书管理</div>
        <div class="panel-body form-inline">
            <div class="input-group">
                <span class="input-group-addon">书名</span>
                <input type="text" class="form-control" placeholder="请输入书名" id="bookname">
            </div>
            <div class="input-group">
                <span class="input-group-addon">作者</span>
                <input type="text" class="form-control" placeholder="请输入作者" id="author">
            </div>
            <div class="input-group">
                <span class="input-group-addon">出版社</span>
                <input type="text" class="form-control" placeholder="请输入出版社" id="publisher">
            </div>
            <button class="btn btn-primary" id="addBtn">添加</button>
        </div>
    </div>

    <!-- 图书列表表格 -->
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>id</th>
                <th>书名</th>
                <th>作者</th>
                <th>出版社</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <!-- <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr> -->
        </tbody>
    </table>
</body>
<script>
    getBookList();
    function getBookList() {
        // 获取图书列表数据    
        $.ajax({
            type: "get",
            url: "http://www.liulongbin.top:3006/api/getbooks",
            success: function (res) {
                if (res.status != 200) return alert("获取图书列表失败")
                var html = '';
                res.data.forEach(function (value, index) {
                    html += `<tr>
                <td>${value.id}</td>
                <td>${value.bookname}</td>
                <td>${value.author}</td>
                <td>${value.publisher}</td>
                <td><a href="javascript:;" data-id="${value.id}">删除</a></td>
            </tr>`
                })
                $("tbody").html(html)
            }
        })
    }
    // 添加图书信息
    $("#addBtn").on("click", function () {
        var bookname = $("#bookname").val().trim();
        var author = $("#author").val().trim();
        var publisher = $("#publisher").val().trim();
        if (bookname.length <= 0 || author.length <= 0 || publisher.length <= 0) return alert("请填写完整信息");
        // console.log(123);
        // post请求记得数据加在data里
        $.ajax({
            type: "post",
            url: "http://www.liulongbin.top:3006/api/addbook",
            data: {
                // data中对象名和属性值一样可以简写(属性值是变量时)
                // bookname: bookname,
                // author: author,
                // publisher: publisher
                bookname,
                author,
                publisher
            },
            success: function (res) {
                // console.log(res);
                // 添加图书成功就重新获取图书列表
                getBookList()
            }
        })
    })

    // 删除图书
    $("tbody").on("click", "a", function () {
        // 给a自定义id 和id一致
        var id = $(this).attr("data-id");
        $.ajax({
            type: "get",
            url: "http://www.liulongbin.top:3006/api/delbook",
            data: {
                id
            },
            // 删除的this指向用箭头函数直接指向btn
            success: (res) => {
                console.log(id);
                if (res.status != 200) return alert("删除图书失败");
                $(this).parents("tr").remove()
            }
        })
    })
</script>

</html>